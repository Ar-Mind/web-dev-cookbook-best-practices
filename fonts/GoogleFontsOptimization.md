# Оптимизация загрузки Google Fonts

## Проблема

Если вы используете кастомные шрифты (в том числе Google Fonts), Chrome и Firefox не рендерят текст на странице сразу же. Вместо этого они держат текст невидимым несколько секунд, пока этот шрифт не загрузится. Это не очень заметно с быстрой сетью, но довольно неприятно на мобильных.

## Как это решают обычно

Обычно, чтобы решить это, используют CSS-рул [font-display](https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display). Проблема в том, что в Google Fonts [font-display не поддерживается](https://github.com/google/fonts/issues/358), и единственная альтернатива — хостить шрифты на своих серверах, а это неудобно. (Есть ещё всякие JS-библиотеки вроде Webfont Loader, но с ними шрифт при первом посещении загружается медленнее.)

## Как работает это решение 

Чтобы решить это, [Иван](https://t.me/iamakulov_channel) сделал скрипт, который фетчит CSS-файл гугл-шрифтов асинхронно, добавляет туда правила font-display и вставляет его в документ. А чтобы перформанс не падал, скрипт ещё генерирует несколько вспомогательных тегов вроде [link rel="preload"](https://developer.mozilla.org/ru/docs/Web/HTML/Preloading_content).

## Результаты

Например, [wordpress.org](wordpress.org). Если загружать его на быстром 3G с этим скриптом, то текст рендерится [на две секунды раньше, чем без скрипта](https://www.webpagetest.org/video/compare.php?tests=190214_5S_353d1e658663bfe996ceaee8093aa578,190214_VQ_e6c965dc8137d95b37234e93840f13ce#).

## Инструкция

[googlefonts.3perf.com](googlefonts.3perf.com)
